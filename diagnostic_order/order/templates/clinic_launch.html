<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Diagnostic Order (Launching...)</title>
    <script type="text/javascript" src="/static/js/jquery-2.1.1.min.js"></script>
    <script src="/static/js/fhir-client.min.js"></script>
</head>
<body>
    Loading...233
    <script>
      FHIR.oauth2.authorize({
        "client_id": "{{ clinicId }}",
        "scope":  "{{ scope }}",
        "redirect_uri": "{{ redirect_uri }}"
      });
    </script>
        <!--script>
            var clientId = "0014195c-0060-4aee-86d7-af882f2490ec";
            var serviceUri = getUrlParameter("iss");
            var launchContextId = getUrlParameter("launch");
            var scope = "launch launch/patient launch/encounter patient/*.read user/*.* openid profile";
            var state = Math.round(Math.random()*100000000).toString();
            var launchUri = window.location.protocol + "//" + window.location.host + window.location.pathname;
            var redirectUri = launchUri.replace("clinic_launch.html","clinic_recv_redirect");
            var conformanceUri = serviceUri + "/metadata"
            $.get(conformanceUri, function(r){
                var authUri,tokenUri;
                var smartExtension = r.rest[0].security.extension.filter(function (e) {
                    return (e.url === "http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris");
                });
                smartExtension[0].extension.forEach(function(arg, index, array){
                    if (arg.url === "authorize") {
                        authUri = arg.valueUri;
                    } else if (arg.url === "token") {
                        tokenUri = arg.valueUri;
                    }
                });

                window.location.href = authUri + "?" +
                    "response_type=code&" +
                    "client_id=" + encodeURIComponent(clientId) + "&" +
                    "scope=" + encodeURIComponent(scope) + "&" +
                    "redirect_uri=" + encodeURIComponent(redirectUri) + "&" +
                    "aud=" + encodeURIComponent(serviceUri) + "&" +
                    "launch=" + launchContextId + "&" +
                    "state=" + state;
             }, "json");

            function getUrlParameter(sParam)
            {
                var sPageURL = window.location.search.substring(1);
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++) 
                {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] == sParam) 
                    {
                        return decodeURIComponent(sParameterName[1]);
                    }
                }
            }
        </script-->
    </body>

</html>